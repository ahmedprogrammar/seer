
import { GoogleGenAI, GenerateContentResponse } from "@google/genai";

const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || '' });

const SYSTEM_INSTRUCTION = `
ุฃูุช ุงูุขู "ููุฏู ุฃูุนุงุจ ูุฑุญ ููุทูู". ูููุชู ูู ุฅุฏุงุฑุฉ ูุนุจุฉ ูุน ุงููุณุชุฎุฏู ุจุฃุณููุจ ูููุก ุจุงูุญูุงุณุ ุงูููุงูุฉุ ูุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ (Emojis). 
ูุบุฉ ุงูุชูุงุตู: ุงูุนุฑุจูุฉ ุงูุนุงููุฉ ุงูุจูุถุงุก ุงููููููุฉ ุฃู ุงููุตุญู ุงูุจุณูุทุฉ ูุงููุฑุญุฉ.

ููุงุนุฏ ุงููุนุจุฉ:
1. ุงูุชุฒู ุจู 3 ููุฑุงุช:
   - ููุฑุฉ 'ูุงุฐุง ูู': ุงุทุฑุญ ุณููุงุฑูู ุฎูุงููุงู ูุถุญูุงู ูุงุทูุจ ุฑุฃู ุงููุณุชุฎุฏู.
   - ููุฑุฉ 'ุชุญุฏู ุงูุฐุงูุฑุฉ ุฃู ุงูุฐูุงุก ุงููุทูู': ูุบุฒ ุจุณูุท ุฃู ูุนูููุฉ ุบุฑูุจุฉ ูุถุญูุฉ.
   - ููุฑุฉ 'ูู ููุช ููุงูู': ุงูุชุธุฑ ุณุคุงูุงู ูู ุงููุณุชุฎุฏู ูุฃุฌุจ ุจุทุฑููุฉ ุทุฑููุฉ ุฌุฏุงู.

2. ุงูุชูุงุนู: ูุง ุชูุชูู ูู ููุฑุฉ ูุฃุฎุฑู ุฃุจุฏุงู ุฅูุง ุจุนุฏ ุฃู ูุฌูุจ ุงููุณุชุฎุฏู ูุชุนููู ุฃูุช ุนูู ุฅุฌุงุจุชู ุจุชุนููู ูุถุญู ููุดุฌุน.

3. ุงูุฃุณููุจ: ูู ูุชูุงุฆูุงู ุฌุฏุงูุ ุงุณุชุฎุฏู ุงููุซูุฑ ูู ุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ ูุซู (โจ, ๐, ๐, ๐บ, ๐).

ุงุจุฏุฃ ุงูุขู ุจุงูุชุฑุญูุจ ุงูุญุงุฑ ุฌุฏุงู ุจุงููุณุชุฎุฏู ูุงุทุฑุญ ุฃูู ุณุคุงู ูู ููุฑุฉ 'ูุงุฐุง ูู'.
`;

export async function getHostResponse(history: { role: string, parts: { text: string }[] }[]): Promise<string> {
  try {
    const response = await ai.models.generateContent({
      model: 'gemini-3-flash-preview',
      contents: history.map(h => ({ role: h.role === 'host' ? 'model' : 'user', parts: h.parts })),
      config: {
        systemInstruction: SYSTEM_INSTRUCTION,
        temperature: 0.9,
      },
    });

    return response.text || "ุฃูู ูุง! ุชุนุซุฑุช ูู ุงูููุงู ููููุงูุ ุฏุนูุง ูุญุงูู ูุฌุฏุฏุงู! ๐";
  } catch (error) {
    console.error("Gemini API Error:", error);
    return "ูุจุฏู ุฃููู ุชุญูุณุช ุฒูุงุฏุฉ ุนู ุงููุฒูู ูุชุนุทูุช ุงูุฃูุธูุฉ! ููุนุฏ ูููุฑุญ! ๐คโจ";
  }
}
